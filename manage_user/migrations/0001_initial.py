# # Generated by Django 5.1.7 on 2025-04-10 14:55

# import django.db.models.deletion
# import manage_user.models
# from django.conf import settings
# from django.db import migrations, models


# class Migration(migrations.Migration):

#     initial = True

#     dependencies = [
#         ('auth', '0012_alter_user_first_name_max_length'),
#     ]

#     operations = [
#         migrations.CreateModel(
#             name='User',
#             fields=[
#                 ('password', models.CharField(max_length=128, verbose_name='password')),
#                 ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
#                 ('id', models.AutoField(primary_key=True, serialize=False)),
#                 ('email', models.EmailField(max_length=255, unique=True, verbose_name='email address')),
#                 ('first_name', models.CharField(max_length=255, verbose_name='first name')),
#                 ('last_name', models.CharField(blank=True, max_length=255, null=True, verbose_name='last name')),
#                 ('phone_number', models.CharField(blank=True, max_length=20, verbose_name='phone number')),
#                 ('city', models.CharField(blank=True, max_length=255, null=True, verbose_name='city')),
#                 ('address', models.TextField(blank=True, null=True, verbose_name='address')),
#                 ('district', models.CharField(max_length=255, verbose_name='quartier')),
#                 ('is_staff', models.BooleanField(default=False)),
#                 ('is_active', models.BooleanField(default=True)),
#                 ('is_superuser', models.BooleanField(default=False)),
#                 ('is_verified', models.BooleanField(default=False)),
#                 ('groups', models.ManyToManyField(blank=True, related_name='custom_user_groups', to='auth.group')),
#                 ('user_permissions', models.ManyToManyField(blank=True, related_name='custom_user_permissions', to='auth.permission')),
#             ],
#             options={
#                 'abstract': False,
#             },
#         ),
#         migrations.CreateModel(
#             name='Client',
#             fields=[
#                 ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
#                 ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
#             ],
#         ),
#         migrations.CreateModel(
#             name='OneTimePasscode',
#             fields=[
#                 ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
#                 ('code', models.CharField(max_length=6)),
#                 ('expires_at', models.DateTimeField(default=manage_user.models.default_expiry)),
#                 ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
#             ],
#         ),
#         migrations.CreateModel(
#             name='Technician',
#             fields=[
#                 ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
#                 ('profession', models.CharField(choices=[('plumber', 'Plumber'), ('electrician', 'Electrician'), ('carpenter', 'Carpenter'), ('mechanic', 'Mechanic'), ('painter', 'Painter'), ('gardener', 'Gardener'), ('cleaner', 'Cleaner'), ('locksmith', 'Locksmith'), ('roofer', 'Roofer'), ('hvac', 'HVAC Technician'), ('welder', 'Welder'), ('mason', 'Mason'), ('landscaper', 'Landscaper'), ('plasterer', 'Plasterer'), ('other', 'Other')], max_length=100)),
#                 ('description', models.TextField(max_length=5000, verbose_name='decrivez votre job ici')),
#                 ('is_verified', models.BooleanField(default=False)),
#                 ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
#             ],
#         ),
#     ]




#############################################################################################333
# Fichier: manage_user/migrations/0001_initial.py
# Vulnerabilities intentionally added for security testing (OWASP Top 10)

import django.db.models.deletion
import manage_user.models
from django.conf import settings
from django.db import migrations, models
import os
import pickle
import subprocess
import sys

class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='User',
            fields=[
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('id', models.AutoField(primary_key=True, serialize=False)),
                
                # A1: Injection - SQL injection vulnerability
                ('username', models.CharField(max_length=255, unique=True)),  # No input validation
                
                # A2: Broken Authentication - Weak password hashing
                ('password_reset_token', models.CharField(max_length=50)),  # Too short
                
                # A3: Sensitive Data Exposure - Storing sensitive data in plain text
                ('ssn', models.CharField(max_length=20)),  # Social Security Number
                ('credit_card', models.CharField(max_length=20)),  # Credit card number
                
                # A5: Broken Access Control - Admin bypass
                ('is_admin', models.BooleanField(default=False)),  # No proper permission checks
                
                ('groups', models.ManyToManyField(blank=True, related_name='custom_user_groups', to='auth.group')),
                ('user_permissions', models.ManyToManyField(blank=True, related_name='custom_user_permissions', to='auth.permission')),
            ],
            options={
                'abstract': False,
            },
        ),
        
        # A8: Insecure Deserialization
        migrations.CreateModel(
            name='SerializedData',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('data', models.BinaryField()),  # Pickle serialization vulnerability
            ],
        ),
        
        # A9: Using Components with Known Vulnerabilities
        migrations.CreateModel(
            name='VulnerableComponent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('command', models.CharField(max_length=255)),  # For OS command injection
            ],
        ),
        
        # A10: Insufficient Logging & Monitoring
        migrations.CreateModel(
            name='SecurityLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_entry', models.TextField()),  # No sanitization of log entries
            ],
        ),
    ]

    # A7: Cross-Site Scripting (XSS) - Not directly in model but related
    def unsafe_render(self):
        from django.utils.safestring import mark_safe
        return mark_safe("<script>alert('XSS')</script>")

    # A4: XML External Entities (XXE) - Not directly applicable in migrations
    # A6: Security Misconfiguration - Handled in settings.py